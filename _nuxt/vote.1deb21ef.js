import{_ as ae,a as se}from"./recaptcha.vue.bcae15e6.js";import{f as te,r as m,k as Y,h as P,y as oe,m as le,B as ie,i as ce,j as V,u as de,E as ue,G as y,c as S,b as w,J as U,a as u,w as R,F as W,K,g as M,I as fe,o as _,t as j,d as N,z as me,v as ve}from"./entry.817a2c52.js";import{u as he}from"./useMe.58eeaba5.js";import{V as _e,c as pe,u as re,b as ge,_ as be}from"./index.d72b8b73.js";import{i as X,o as xe,u as ye}from"./useUnknownError.bfaf3dc7.js";import{a as we,_ as ke}from"./Modal.5b15a7f3.js";import{t as ze}from"./Tag.60aa3892.js";import{c as Ee,g as Z,F as Re,f as q,G as Ce,q as Q,u as Le,b as ne,m as Se,j as Fe,H as je,n as Te,D as $e,_ as Be}from"./Button.b6bb4617.js";import{u as Oe,_ as Pe}from"./Spin.70d93fdf.js";import{_ as Ve}from"./Divider.853a11de.js";import{_ as He}from"./Result.f1fbae6c.js";import"./ready.e9138dc9.js";import"./index.cd32510b.js";import"./asyncData.96a3e033.js";import"./light.61a62dad.js";const Ie=Ee("n-avatar-group"),Me=Z("avatar",`
 width: var(--n-merged-size);
 height: var(--n-merged-size);
 color: #FFF;
 font-size: var(--n-font-size);
 display: inline-flex;
 position: relative;
 overflow: hidden;
 text-align: center;
 border: var(--n-border);
 border-radius: var(--n-border-radius);
 --n-merged-color: var(--n-color);
 background-color: var(--n-merged-color);
 transition:
 border-color .3s var(--n-bezier),
 background-color .3s var(--n-bezier),
 color .3s var(--n-bezier);
`,[Re(q("&","--n-merged-color: var(--n-color-modal);")),Ce(q("&","--n-merged-color: var(--n-color-popover);")),q("img",`
 width: 100%;
 height: 100%;
 `),Q("text",`
 white-space: nowrap;
 display: inline-block;
 position: absolute;
 left: 50%;
 top: 50%;
 `),Z("icon",`
 vertical-align: bottom;
 font-size: calc(var(--n-merged-size) - 6px);
 `),Q("text","line-height: 1.25")]),Ne=Object.assign(Object.assign({},ne.props),{size:[String,Number],src:String,circle:{type:Boolean,default:void 0},objectFit:String,round:{type:Boolean,default:void 0},bordered:{type:Boolean,default:void 0},onError:Function,fallbackSrc:String,intersectionObserverOptions:Object,lazy:Boolean,onLoad:Function,renderPlaceholder:Function,renderFallback:Function,imgProps:Object,color:String}),Ae=te({name:"Avatar",props:Ne,setup(n){const{mergedClsPrefixRef:i,inlineThemeDisabled:f}=Le(n),a=m(!1);let l=null;const s=m(null),c=m(null),p=()=>{const{value:t}=s;if(t&&(l===null||l!==t.innerHTML)){l=t.innerHTML;const{value:e}=c;if(e){const{offsetWidth:r,offsetHeight:o}=e,{offsetWidth:d,offsetHeight:$}=t,L=.9,B=Math.min(r/d*L,o/$*L,1);t.style.transform=`translateX(-50%) translateY(-50%) scale(${B})`}}},v=Y(Ie,null),k=P(()=>{const{size:t}=n;if(t)return t;const{size:e}=v||{};return e||"medium"}),F=ne("Avatar","-avatar",Me,we,n,i),h=Y(ze,null),g=P(()=>{if(v)return!0;const{round:t,circle:e}=n;return t!==void 0||e!==void 0?t||e:h?h.roundRef.value:!1}),C=P(()=>v?!0:n.bordered||!1),z=t=>{var e;if(!T.value)return;a.value=!0;const{onError:r,imgProps:o}=n;(e=o==null?void 0:o.onError)===null||e===void 0||e.call(o,t),r&&r(t)};oe(()=>n.src,()=>a.value=!1);const H=P(()=>{const t=k.value,e=g.value,r=C.value,{color:o}=n,{self:{borderRadius:d,fontSize:$,color:L,border:B,colorModal:A,colorPopover:G},common:{cubicBezierEaseInOut:D}}=F.value;let O;return typeof t=="number"?O=`${t}px`:O=F.value.self[Se("height",t)],{"--n-font-size":$,"--n-border":r?B:"none","--n-border-radius":e?"50%":d,"--n-color":o||L,"--n-color-modal":o||A,"--n-color-popover":o||G,"--n-bezier":D,"--n-merged-size":`var(--n-avatar-size-override, ${O})`}}),E=f?Fe("avatar",P(()=>{const t=k.value,e=g.value,r=C.value,{color:o}=n;let d="";return t&&(typeof t=="number"?d+=`a${t}`:d+=t[0]),e&&(d+="b"),r&&(d+="c"),o&&(d+=je(o)),d}),H,n):void 0,T=m(!n.lazy);le(()=>{if(X)return;let t;const e=ie(()=>{t==null||t(),t=void 0,n.lazy&&(t=xe(c.value,n.intersectionObserverOptions,T))});ce(()=>{e(),t==null||t()})});const I=m(!n.lazy);return{textRef:s,selfRef:c,mergedRoundRef:g,mergedClsPrefix:i,fitTextTransform:p,cssVars:f?void 0:H,themeClass:E==null?void 0:E.themeClass,onRender:E==null?void 0:E.onRender,hasLoadError:a,handleError:z,shouldStartLoading:T,loaded:I,mergedOnLoad:t=>{var e;const{onLoad:r,imgProps:o}=n;r==null||r(t),(e=o==null?void 0:o.onLoad)===null||e===void 0||e.call(o,t),I.value=!0}}},render(){var n,i;const{$slots:f,src:a,mergedClsPrefix:l,lazy:s,onRender:c,mergedOnLoad:p,shouldStartLoading:v,loaded:k,hasLoadError:F}=this;c==null||c();let h;const g=!k&&!F&&(this.renderPlaceholder?this.renderPlaceholder():(i=(n=this.$slots).placeholder)===null||i===void 0?void 0:i.call(n));return this.hasLoadError?h=this.renderFallback?this.renderFallback():Te(f.fallback,()=>[V("img",{src:this.fallbackSrc,style:{objectFit:this.objectFit}})]):h=$e(f.default,C=>{if(C)return V(_e,{onResize:this.fitTextTransform},{default:()=>V("span",{ref:"textRef",class:`${l}-avatar__text`},C)});if(a){const{imgProps:z}=this;return V("img",Object.assign(Object.assign({},z),{loading:X&&!this.intersectionObserverOptions&&s?"lazy":"eager",src:X||v||k?a:void 0,onLoad:p,"data-image-src":a,onError:this.handleError,style:[z==null?void 0:z.style,{objectFit:this.objectFit},g?{height:"0",width:"0",visibility:"hidden",position:"absolute"}:""]}))}}),V("span",{ref:"selfRef",class:[`${l}-avatar`,this.themeClass],style:this.cssVars},h,s&&g)}}),Ge=async(n,i,f)=>{var c,p;const a=pe("token",null).value;if(!a)throw Error("no token");const{data:l,error:s}=await re("/form/all",{baseURL:"https://124.223.35.239/api/v1",headers:{authorization:`Bearer ${a}`},params:{page:n,page_long:i,sort:f}},"$3FbuzmXuuA");if(!s.value)return l;throw s.value.statusCode===500?Error("服务端错误，请联系网站管理员"):Error(((c=s.value.data)==null?void 0:c.message)??s.value.message??((p=s.value.data)==null?void 0:p.code))},De=async(n,i)=>{var l,s;const{data:f,error:a}=await re("/form/like",{baseURL:"https://124.223.35.239/api/v1",method:"post",params:{captoken:i,name:n}},"$Dalx9gXCTf");if(!a.value)return f;throw a.value.statusCode===500?Error("服务端错误，请联系网站管理员"):Error(((l=a.value.data)==null?void 0:l.message)??a.value.message??((s=a.value.data)==null?void 0:s.code))},Ue={key:0,"my-4":"","max-w-1080px":"","w-90vw":"",flex:"","flex-col":"","items-center":"","gap-4":""},We={key:0,"w-full":""},Ke={"w-full":"","text-end":""},Xe=u("div",{"i-material-symbols-sort":"","text-xl":""},null,-1),qe={flex:"","flex-wrap":"","justify-center":"","gap-3":""},Je={flex:"","items-center":"","gap-4":""},Ye={flex:"","flex-col":""},Ze={"text-xl":"","font-bold":""},Qe={"text-slate-500":""},et={flex:"","items-center":"","justify-between":""},tt={flex:"","text-slate-500":""},ot=u("div",null,"得票数：",-1),rt={"font-bold":""},nt={flex:"","flex-wrap":"","gap-4":"",color:"#2A3990","text-lg":""},at={flex:"","flex-wrap":"","gap-4":"",color:"#9C254D","text-lg":""},J=1,ee=6,yt=te({__name:"vote",setup(n){de({title:"全部队伍 丨 ASG 第五人格赛事"});const i=ue([]),f=m(!0),a=m(J),l=Oe(),s=m(!1),c=m(null),{me:p}=he(),v=m(!0),k=m(null),F=ge(),h=m("vote"),g=async()=>{try{const e=await Ge(a.value,ee,h.value);return i.push(...e.value.map(r=>({logo:r.logo_uri,members:r.rolename.map(o=>({camp:o.lin==="求生者",name:o.name})),name:r.name,time:new Date(r.timer).toLocaleString(),vote:r.piaoshu}))),f.value=!1,e}catch(e){e instanceof Error&&l.error(e.message)}return m([])},C=async()=>{f.value=!0,a.value++,(await g()).value.length===0&&l.info("没有更多数据了")};oe(p,async()=>{a.value=J,p.value&&(await g(),v.value=!1)},{immediate:!0});const z=e=>{k.value=e,s.value=!0},H=async e=>{const r=k.value;if(r){try{r.vote=(await De(r.name,e)).value.number,l.success("投票成功")}catch(o){o instanceof Error&&l.error(o.message)}s.value=!1}},E=()=>{var e;(e=c.value)==null||e.reset()},T=()=>{var e;l.info("验证失败"),(e=c.value)==null||e.reset()},I=e=>{ye()},t=async()=>{h.value=h.value==="time"?"vote":"time",v.value=!0,a.value=J,i.splice(0),await g(),v.value=!1};return(e,r)=>{const o=ae,d=Be,$=Ae,L=Ve,B=be,A=Pe,G=se,D=ke,O=He;return y(p)?(_(),S("div",Ue,[y(v)?(_(),S("div",We,[w(o,{text:"",repeat:2}),w(o,{text:"",style:{width:"60%"}})])):U("",!0),u("div",Ke,[w(d,{text:"",onClick:t},{default:R(()=>[u("div",null,j(y(h)==="time"?"时间":"票数")+"排序",1),Xe]),_:1})]),u("div",qe,[(_(!0),S(W,null,K(y(i),b=>(_(),M(B,{key:b.name,"max-w-350px":""},{default:R(()=>[u("div",Je,[w($,{size:84,src:b.logo||"#","fallback-src":"~/assets/carousel-logo.webp","flex-none":"",color:"transparent"},null,8,["src"]),u("div",Ye,[u("div",Ze,j(b.name),1),u("div",Qe," 报名时间："+j(b.time),1),u("div",et,[u("div",tt,[ot,u("div",rt,j(b.vote),1)]),w(d,{size:"small",type:"primary",onClick:x=>z(b)},{default:R(()=>[N(" 投票 ")]),_:2},1032,["onClick"])])])]),w(L,{color:"#2A3990"},{default:R(()=>[N(" 求生者 ")]),_:1}),u("div",nt,[(_(!0),S(W,null,K(b.members.filter(x=>x.camp),x=>(_(),S("div",{key:x.name,"text-lg":""},j(x.name),1))),128))]),w(L,{color:"#9C254D"},{default:R(()=>[N(" 监管者 ")]),_:1}),u("div",at,[(_(!0),S(W,null,K(b.members.filter(x=>!x.camp),x=>(_(),S("div",{key:x.name,"text-lg":""},j(x.name),1))),128))])]),_:2},1024))),128))]),y(v)?U("",!0):(_(),M(A,{key:1,show:y(f),size:"small"},{default:R(()=>[y(i).length===ee?(_(),M(d,{key:0,text:"",type:"primary",size:"large",onClick:C},{default:R(()=>[N(" 查看更多 ")]),_:1})):U("",!0)]),_:1},8,["show"])),w(D,{show:y(s),"onUpdate:show":r[0]||(r[0]=b=>fe(s)?s.value=b:null),"mask-closable":!1,"max-w-350px":"",preset:"card"},{default:R(()=>[me(w(G,{ref_key:"reCaptchaRef",ref:c,theme:y(F)?"dark":"light",onVerify:H,onExpire:E,onFail:T,onError:I},null,8,["theme"]),[[ve,y(s)]])]),_:1},8,["show"])])):(_(),M(O,{key:1,status:"warning",title:"未登录",description:"在查看全部战队信息前请先登录",style:{"min-height":"calc(100vh - 50px - 60px)"},flex:"","flex-col":"","justify-center":"",size:"huge"}))}}});export{yt as default};
