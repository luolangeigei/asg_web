import{a as I}from"./useNarrowScreen.908aff76.js";import{u as R,a as N}from"./useMe.8baa62df.js";import{e as V,b as L,c as T,_ as G}from"./index.0deabf0b.js";import{_ as H}from"./Tag.473bad75.js";import{f as B,r as p,y as U,o as u,g as x,w as h,a as c,H as C,G as t,I as X,c as g,t as d,J as j,b as y,d as E,D as q,u as A}from"./entry.f4d2fbff.js";import{_ as D}from"./Input.34f683f0.js";import{_ as F}from"./Result.085ed373.js";import"./browser.2fb44edf.js";import"./Suffix.6c85beef.js";import"./light.e69c1392.js";const J=async f=>{var e,r;const n=V("token",null).value;if(!n)throw Error("未登录");const{data:i,error:a}=await L("/user/name",{baseURL:"https://124.223.35.239/api/v1",headers:{authorization:`Bearer ${n}`},method:"post",params:{newchinaname:f}},"$XqYTvbX6hx");if(!a.value)return i;throw a.value.statusCode===401?(R(),Error("登录过期，请重新登录")):a.value.statusCode===500?Error("服务端错误，请联系网站管理员"):Error(((e=a.value.data)==null?void 0:e.message)??a.value.message??((r=a.value.data)==null?void 0:r.code))},Y=c("div",{"i-material-symbols-person":"","text-8xl":""},null,-1),K={flex:"","items-center":"","gap-4":""},O={key:1,"text-xl":"","font-bold":""},P={flex:"","items-center":"","gap-2":""},Q={"text-xs":"","text-slate-500":""},W=B({__name:"info",setup(f){const n=I(),i=p(!1),a=p(!1),e=p(""),r=p(null),{me:o,update:z}=N(),v=T();U(o,()=>{const s=o.value;e.value=(s==null?void 0:s.chinaname)??""},{immediate:!0});const M=async()=>{var s,m;if(e.value||(v.error("昵称不能为空"),e.value=((s=o.value)==null?void 0:s.chinaname)??""),e.value!==((m=o.value)==null?void 0:m.chinaname)){i.value=!0;try{await J(e.value),await z(),v.success("修改成功")}catch(_){_ instanceof Error&&v.error(_.message)}}i.value=!1,a.value=!1},S=async()=>{var s;a.value=!0,await q(),(s=r.value)==null||s.focus()};return(s,m)=>{const _=D,w=H,$=G;return u(),x($,{"max-w-1000px":"","w-90vw":""},{default:h(()=>{var k,b;return[c("div",{flex:"","items-center":"","gap-4":"",class:C({"flex-col":t(n)})},[Y,c("div",{"h-full":"",flex:"","flex-col":"","gap-4":"",class:C({"items-center":t(n)})},[c("div",K,[t(a)?(u(),x(_,{key:0,ref_key:"nameInputRef",ref:r,value:t(e),"onUpdate:value":m[0]||(m[0]=l=>X(e)?e.value=l:null),size:"small",placeholder:"请输入新昵称",loading:t(i),onBlur:M},null,8,["value","loading"])):(u(),g("div",O,d((k=t(o))==null?void 0:k.chinaname),1)),t(a)?j("",!0):(u(),g("div",{key:2,"i-material-symbols-edit":"","cursor-pointer":"","text-slate-400":"",onClick:S}))]),c("div",P,[y(w,{size:"small",bordered:!1,type:"info"},{default:h(()=>{var l;return[E(" @"+d((l=t(o))==null?void 0:l.name),1)]}),_:1}),y(w,{size:"small",bordered:!1,type:"success"},{default:h(()=>{var l;return[E(" #"+d((l=t(o))==null?void 0:l.id),1)]}),_:1})]),c("div",Q,d((b=t(o))==null?void 0:b.email),1)],2)],2)]}),_:1})}}}),Z={key:0,"my-4":"",flex:"","flex-col":"","gap-4":""},ue=B({__name:"me",setup(f){A({title:"个人中心 丨 ASG 第五人格赛事"});const{me:n}=N();return(i,a)=>{const e=W,r=F;return t(n)?(u(),g("div",Z,[y(e)])):(u(),x(r,{key:1,status:"warning",title:"未登录",description:"在查看个人信息前请先登录",style:{"min-height":"calc(100vh - 50px - 60px)"},flex:"","flex-col":"","justify-center":"",size:"huge"}))}}});export{ue as default};
