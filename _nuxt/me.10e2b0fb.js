import{u as q,a as ee}from"./useLogout.8d99b21e.js";import{n as _e,N as fe,u as O,a as X,_ as Y,d as pe}from"./use-message.66bdeb61.js";import{a as G}from"./index.51fa0266.js";import{o as D}from"./ready.3c027d06.js";import{f as V,h as Q,r as E,q as y,A as he,j as U,E as oe,o as f,g,w as i,a as W,i as a,b as _,d as k,D as re,c as H,t as M,G as ge,L as ve,P as be,F as Ce,k as xe,u as ye}from"./entry.6528f58e.js";import{_ as te,a as ne}from"./text.bd3463fb.js";import{_ as we,u as ke,a as Ee,b as $e}from"./useMyEnroll.2fe29dc6.js";import{b as se,c as ae,_ as Ie,d as ze}from"./Spin.91702866.js";import{_ as Re}from"./Tag.82b04240.js";import{_ as le}from"./nuxt-link.cb32d008.js";import{_ as Be}from"./team.vue.82944585.js";import{c as Se,_ as Le}from"./drawer-or-modal.vue.46697bd9.js";import{q as Te,v as L,w as T,e as N,f as I,h as Z,g as Pe,u as Ae,j as ie,l as We,x as R,k as He,y as Fe,n as Ne,z as Me,N as Ue,_ as ce}from"./Button.b8ae23dc.js";import{f as Ve}from"./useNarrowScreen.95e8d4e4.js";import{E as je,W as qe,I as Oe,S as Ge}from"./light.01ebe78d.js";import{_ as De}from"./Result.3ad77dfb.js";import"./Avatar.e5832989.js";import"./Tooltip.e5122ebf.js";import"./_createCompounder.da2419fd.js";import"./Modal.948a7be0.js";const Je=u=>{const{lineHeight:o,borderRadius:n,fontWeightStrong:t,baseColor:r,dividerColor:d,actionColor:m,textColor1:h,textColor2:s,closeColorHover:v,closeColorPressed:C,closeIconColor:w,closeIconColorHover:b,closeIconColorPressed:l,infoColor:e,successColor:c,warningColor:p,errorColor:x,fontSize:$}=u;return Object.assign(Object.assign({},Se),{fontSize:$,lineHeight:o,titleFontWeight:t,borderRadius:n,border:`1px solid ${d}`,color:m,titleTextColor:h,iconColor:s,contentTextColor:s,closeBorderRadius:n,closeColorHover:v,closeColorPressed:C,closeIconColor:w,closeIconColorHover:b,closeIconColorPressed:l,borderInfo:`1px solid ${L(r,T(e,{alpha:.25}))}`,colorInfo:L(r,T(e,{alpha:.08})),titleTextColorInfo:h,iconColorInfo:e,contentTextColorInfo:s,closeColorHoverInfo:v,closeColorPressedInfo:C,closeIconColorInfo:w,closeIconColorHoverInfo:b,closeIconColorPressedInfo:l,borderSuccess:`1px solid ${L(r,T(c,{alpha:.25}))}`,colorSuccess:L(r,T(c,{alpha:.08})),titleTextColorSuccess:h,iconColorSuccess:c,contentTextColorSuccess:s,closeColorHoverSuccess:v,closeColorPressedSuccess:C,closeIconColorSuccess:w,closeIconColorHoverSuccess:b,closeIconColorPressedSuccess:l,borderWarning:`1px solid ${L(r,T(p,{alpha:.33}))}`,colorWarning:L(r,T(p,{alpha:.08})),titleTextColorWarning:h,iconColorWarning:p,contentTextColorWarning:s,closeColorHoverWarning:v,closeColorPressedWarning:C,closeIconColorWarning:w,closeIconColorHoverWarning:b,closeIconColorPressedWarning:l,borderError:`1px solid ${L(r,T(x,{alpha:.25}))}`,colorError:L(r,T(x,{alpha:.08})),titleTextColorError:h,iconColorError:x,contentTextColorError:s,closeColorHoverError:v,closeColorPressedError:C,closeIconColorError:w,closeIconColorHoverError:b,closeIconColorPressedError:l})},Ke={name:"Alert",common:Te,self:Je},Xe=Ke,Ye=N("alert",`
 line-height: var(--n-line-height);
 border-radius: var(--n-border-radius);
 position: relative;
 transition: background-color .3s var(--n-bezier);
 background-color: var(--n-color);
 text-align: start;
 word-break: break-word;
`,[I("border",`
 border-radius: inherit;
 position: absolute;
 left: 0;
 right: 0;
 top: 0;
 bottom: 0;
 transition: border-color .3s var(--n-bezier);
 border: var(--n-border);
 pointer-events: none;
 `),Z("closable",[N("alert-body",[I("title",`
 padding-right: 24px;
 `)])]),I("icon",{color:"var(--n-icon-color)"}),N("alert-body",{padding:"var(--n-padding)"},[I("title",{color:"var(--n-title-text-color)"}),I("content",{color:"var(--n-content-text-color)"})]),Ve({originalTransition:"transform .3s var(--n-bezier)",enterToProps:{transform:"scale(1)"},leaveToProps:{transform:"scale(0.9)"}}),I("icon",`
 position: absolute;
 left: 0;
 top: 0;
 align-items: center;
 justify-content: center;
 display: flex;
 width: var(--n-icon-size);
 height: var(--n-icon-size);
 font-size: var(--n-icon-size);
 margin: var(--n-icon-margin);
 `),I("close",`
 transition:
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 position: absolute;
 right: 0;
 top: 0;
 margin: var(--n-close-margin);
 `),Z("show-icon",[N("alert-body",{paddingLeft:"calc(var(--n-icon-margin-left) + var(--n-icon-size) + var(--n-icon-margin-right))"})]),N("alert-body",`
 border-radius: var(--n-border-radius);
 transition: border-color .3s var(--n-bezier);
 `,[I("title",`
 transition: color .3s var(--n-bezier);
 font-size: 16px;
 line-height: 19px;
 font-weight: var(--n-title-font-weight);
 `,[Pe("& +",[I("content",{marginTop:"9px"})])]),I("content",{transition:"color .3s var(--n-bezier)",fontSize:"var(--n-font-size)"})]),I("icon",{transition:"color .3s var(--n-bezier)"})]),Qe=Object.assign(Object.assign({},ie.props),{title:String,showIcon:{type:Boolean,default:!0},type:{type:String,default:"default"},bordered:{type:Boolean,default:!0},closable:Boolean,onClose:Function,onAfterLeave:Function,onAfterHide:Function}),Ze=V({name:"Alert",inheritAttrs:!1,props:Qe,setup(u){const{mergedClsPrefixRef:o,mergedBorderedRef:n,inlineThemeDisabled:t,mergedRtlRef:r}=Ae(u),d=ie("Alert","-alert",Ye,Xe,u,o),m=We("Alert",r,o),h=Q(()=>{const{common:{cubicBezierEaseInOut:l},self:e}=d.value,{fontSize:c,borderRadius:p,titleFontWeight:x,lineHeight:$,iconSize:B,iconMargin:S,iconMarginRtl:P,closeIconSize:F,closeBorderRadius:J,closeSize:j,closeMargin:K,closeMarginRtl:A,padding:ue}=e,{type:z}=u,{left:de,right:me}=_e(S);return{"--n-bezier":l,"--n-color":e[R("color",z)],"--n-close-icon-size":F,"--n-close-border-radius":J,"--n-close-color-hover":e[R("closeColorHover",z)],"--n-close-color-pressed":e[R("closeColorPressed",z)],"--n-close-icon-color":e[R("closeIconColor",z)],"--n-close-icon-color-hover":e[R("closeIconColorHover",z)],"--n-close-icon-color-pressed":e[R("closeIconColorPressed",z)],"--n-icon-color":e[R("iconColor",z)],"--n-border":e[R("border",z)],"--n-title-text-color":e[R("titleTextColor",z)],"--n-content-text-color":e[R("contentTextColor",z)],"--n-line-height":$,"--n-border-radius":p,"--n-font-size":c,"--n-title-font-weight":x,"--n-icon-size":B,"--n-icon-margin":S,"--n-icon-margin-rtl":P,"--n-close-size":j,"--n-close-margin":K,"--n-close-margin-rtl":A,"--n-padding":ue,"--n-icon-margin-left":de,"--n-icon-margin-right":me}}),s=t?He("alert",Q(()=>u.type[0]),h,u):void 0,v=E(!0),C=()=>{const{onAfterLeave:l,onAfterHide:e}=u;l&&l(),e&&e()};return{rtlEnabled:m,mergedClsPrefix:o,mergedBordered:n,visible:v,handleCloseClick:()=>{var l;Promise.resolve((l=u.onClose)===null||l===void 0?void 0:l.call(u)).then(e=>{e!==!1&&(v.value=!1)})},handleAfterLeave:()=>{C()},mergedTheme:d,cssVars:t?void 0:h,themeClass:s==null?void 0:s.themeClass,onRender:s==null?void 0:s.onRender}},render(){var u;return(u=this.onRender)===null||u===void 0||u.call(this),y(Ue,{onAfterLeave:this.handleAfterLeave},{default:()=>{const{mergedClsPrefix:o,$slots:n}=this,t={class:[`${o}-alert`,this.themeClass,this.closable&&`${o}-alert--closable`,this.showIcon&&`${o}-alert--show-icon`,this.rtlEnabled&&`${o}-alert--rtl`],style:this.cssVars,role:"alert"};return this.visible?y("div",Object.assign({},he(this.$attrs,t)),this.closable&&y(fe,{clsPrefix:o,class:`${o}-alert__close`,onClick:this.handleCloseClick}),this.bordered&&y("div",{class:`${o}-alert__border`}),this.showIcon&&y("div",{class:`${o}-alert__icon`,"aria-hidden":"true"},Fe(n.icon,()=>[y(Ne,{clsPrefix:o},{default:()=>{switch(this.type){case"success":return y(Ge,null);case"info":return y(Oe,null);case"warning":return y(qe,null);case"error":return y(je,null);default:return null}}})])),y("div",{class:[`${o}-alert-body`,this.mergedBordered&&`${o}-alert-body--bordered`]},Me(n.header,r=>{const d=r||this.title;return d?y("div",{class:`${o}-alert-body__title`},d):null}),n.default&&y("div",{class:`${o}-alert-body__content`},n))):null}})}}),eo=async u=>{var r;const o=G("token",null).value;if(!o)throw Error("未登录");const{data:n,error:t}=await O("/setimg",{baseURL:"https://124.223.35.239/api/v1",body:JSON.stringify(u),headers:{authorization:`Bearer ${o}`},method:"post"},"$uLuKV08PGY");if(!t.value)return n;throw t.value.statusCode===401?(q(),Error("登录过期，请重新登录")):t.value.statusCode===500?Error("服务端错误，请联系网站管理员"):Error(((r=t.value.data)==null?void 0:r.message)??"未知错误，请联系网站管理员")},oo=async u=>{var r;const o=G("token",null).value;if(!o)throw Error("未登录");const{data:n,error:t}=await O("/user/name",{baseURL:"https://124.223.35.239/api/v1",headers:{authorization:`Bearer ${o}`},method:"post",params:{newchinaname:u}},"$XqYTvbX6hx");if(!t.value)return n;throw t.value.statusCode===401?(q(),Error("登录过期，请重新登录")):t.value.statusCode===500?Error("服务端错误，请联系网站管理员"):Error(((r=t.value.data)==null?void 0:r.message)??"未知错误，请联系网站管理员")},ro={flex:"","flex-col":"","items-center":"","gap-4":"","lg:flex-row":""},to=W("br",null,null,-1),no={"h-full":"",flex:"","flex-col":"","items-center":"","gap-4":"","lg:items-start":""},so={flex:"","items-center":"","gap-4":""},ao={key:2,"text-xl":"","font-bold":""},lo={flex:"","items-center":"","gap-2":""},io={key:1,"text-xs":"","text-slate-500":""},co=V({__name:"info",setup(u){const o=U([]),n=E(!1),t=E(!1),r=E(""),d=E(null),{me:m,update:h}=ee(),s=X(),v=E(!1),C=e=>{const{file:c}=e.file;return c?c.size>10**6?(s.error("图片文件大小不能大于1MB"),!1):!0:!1},w=({file:e})=>{if(!e.file)return;v.value=!0;const c=new FileReader;c.readAsDataURL(e.file),c.addEventListener("load",async p=>{var $;const x=($=p.target)==null?void 0:$.result;if(typeof x=="string"){try{await eo(x),h(),s.success("上传成功")}catch(B){B instanceof Error&&s.error(B.message)}v.value=!1}})},b=async()=>{var e,c;if(r.value||(s.error("昵称不能为空"),r.value=((e=m.value)==null?void 0:e.chinaname)??""),r.value!==((c=m.value)==null?void 0:c.chinaname)){n.value=!0;try{await oo(r.value),await h(),s.success("修改成功")}catch(p){p instanceof Error&&s.error(p.message)}}n.value=!1,t.value=!1},l=async()=>{var e;t.value=!0,await ve(),(e=d.value)==null||e.focus()};return D(()=>{oe(m,()=>{const e=m.value;r.value=(e==null?void 0:e.chinaname)??"",e!=null&&e.base64&&(o.splice(0),o.push({id:"current",name:"头像",status:"finished",url:e.base64}))},{immediate:!0})}),(e,c)=>{const p=te,x=we,$=se,B=ae,S=Re,P=Y;return f(),g(P,{style:{width:"calc(100vw - 2rem)"},"max-w-768px":""},{default:i(()=>[W("div",ro,[a(m)?(f(),g($,{key:1,show:a(v)},{default:i(()=>[_(x,{"default-file-list":a(o),accept:"image/*",max:1,color:"#8590a6","list-type":"image-card","w-24":"","custom-request":w,onBeforeUpload:C},{default:i(()=>[k(" 点击上传"),to,k("用户头像 ")]),_:1},8,["default-file-list"])]),_:1},8,["show"])):(f(),g(p,{key:0,"h-24":"","w-24":"",sharp:!1})),W("div",no,[W("div",so,[a(m)?a(t)?(f(),g(B,{key:1,ref_key:"nameInputRef",ref:d,value:a(r),"onUpdate:value":c[0]||(c[0]=F=>re(r)?r.value=F:null),size:"small",placeholder:"请输入新昵称",loading:a(n),onBlur:b},null,8,["value","loading"])):(f(),H("div",ao,M(a(m).chinaname),1)):(f(),g(p,{key:0,text:"","h-28px":"","w-20":""})),a(t)?ge("",!0):(f(),H("div",{key:3,"i-material-symbols-edit":"","cursor-pointer":"","text-slate-400":"",onClick:l}))]),W("div",lo,[a(m)?(f(),g(S,{key:1,size:"small",bordered:!1,type:"info"},{default:i(()=>[k(" @"+M(a(m).name),1)]),_:1})):(f(),g(p,{key:0,text:"","h-22px":"","w-20":""})),a(m)?(f(),g(S,{key:3,size:"small",bordered:!1,type:"success"},{default:i(()=>[k(" #"+M(a(m).id),1)]),_:1})):(f(),g(p,{key:2,text:"","h-22px":"","w-10":""}))]),a(m)?(f(),H("div",io,M(a(m).email),1)):(f(),g(p,{key:0,text:"","h-4":"","w-30":""}))])])]),_:1})}}}),uo=async(u,o)=>{var d;const n=G("token",null).value;if(!n)throw Error("未登录");const{data:t,error:r}=await O("/user/form",{baseURL:"https://124.223.35.239/api/v1",headers:{authorization:`Bearer ${n}`},method:"post",params:{formname:u,formpassword:o}},"$l6xArG38qW");if(!r.value)return t;throw r.value.statusCode===401?(q(),Error("登录过期，请重新登录")):r.value.statusCode===500?Error("服务端错误，请联系网站管理员"):Error(((d=r.value.data)==null?void 0:d.message)??"未知错误，请联系网站管理员")},mo={flex:"","gap-4":""},_o=V({__name:"team",setup(u){const o=X(),n=E(!0),t=U({logo:"",members:[],name:"",password:"",time:"",vote:0}),r=U({name:[{message:"请输入战队名称",required:!0,trigger:"blur"},{message:"该名称不存在",trigger:"blur",validator(l,e){return new Promise((c,p)=>{if(!e){c();return}ke(e).then(x=>{x.value?c():p(Error())}).catch(()=>{Ee()})})}}],password:{message:"请输入战队密码",required:!0,trigger:"blur"}}),d=E(!1),m=E(!1),h=E(null),s=U({name:"",password:""}),v=async()=>{try{const l=await $e();t.logo=l.value.logo_uri,t.members.splice(0),t.members.push(...l.value.role.map(e=>({camp:e.role_lin==="求生者",name:e.role_name}))),t.name=l.value.team_name,t.password=l.value.team_password,t.time=new Date(l.value.time).toLocaleString(),t.vote=l.value.piaoshu}catch(l){l instanceof Error&&o.error(l.message)}},C=()=>{d.value=!0},w=()=>{d.value=!1},b=()=>{var l;m.value=!0,(l=h.value)==null||l.validate(async e=>{if(e){o.error("表单存在错误"),m.value=!1;return}try{await uo(s.name,s.password),d.value=!1,await v(),o.success("绑定成功")}catch(c){c instanceof Error&&o.error(c.message)}m.value=!1})};return D(async()=>{await v(),n.value=!1}),(l,e)=>{const c=ce,p=le,x=pe,$=Be,B=ne,S=ae,P=Ie,F=ze,J=se,j=Y,K=Le;return f(),g(j,{title:"我的战队",style:{width:"calc(100vw - 2rem)"},"max-w-768px":""},be({default:i(()=>[a(n)?(f(),g($,{key:0})):a(t).name?(f(),g($,{key:1,team:a(t)},null,8,["team"])):(f(),g(B,{key:2,description:"你没有参与过报名"},{extra:i(()=>[W("div",mo,[_(p,{to:"/enroll"},{default:i(()=>[_(c,{size:"small",type:"primary"},{default:i(()=>[k(" 前往报名 ")]),_:1})]),_:1}),_(c,{size:"small",onClick:C},{default:i(()=>[k(" 绑定战队 ")]),_:1})])]),_:1})),_(K,{isVisible:a(d),"onUpdate:isVisible":e[2]||(e[2]=A=>re(d)?d.value=A:null),"drawer-height":290},{default:i(()=>[_(j,{title:"绑定战队",closable:"",onClose:w},{default:i(()=>[_(J,{show:a(m)},{description:i(()=>[k(" 加载中…… ")]),default:i(()=>[_(F,{ref_key:"bindingEnrollFormRef",ref:h,model:a(s),rules:a(r),"show-label":!1,size:"large"},{default:i(()=>[_(P,{path:"name"},{default:i(()=>[_(S,{value:a(s).name,"onUpdate:value":e[0]||(e[0]=A=>a(s).name=A),placeholder:"请输入战队名称",clearable:""},null,8,["value"])]),_:1}),_(P,{path:"password"},{default:i(()=>[_(S,{value:a(s).password,"onUpdate:value":e[1]||(e[1]=A=>a(s).password=A),type:"password",placeholder:"请输入战队密码","show-password-on":"click",clearable:""},null,8,["value"])]),_:1}),_(P,null,{default:i(()=>[_(c,{type:"primary","w-full":"",onClick:b},{default:i(()=>[k(" 提交 ")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["show"])]),_:1})]),_:1},8,["isVisible"])]),_:2},[a(t).name?{name:"header-extra",fn:i(()=>[_(p,{to:"/enroll?type=modification"},{default:i(()=>[_(c,{size:"small",tertiary:""},{default:i(()=>[k(" 编辑 ")]),_:1})]),_:1}),_(x,{vertical:""}),_(c,{size:"small",tertiary:"",onClick:C},{default:i(()=>[k(" 换绑 ")]),_:1})]),key:"0"}:void 0]),1024)}}}),fo=async()=>{var t;const u=G("token",null).value;if(!u)throw Error("未登录");const{data:o,error:n}=await O("/game/mylog",{baseURL:"https://124.223.35.239/api/v1",headers:{authorization:`Bearer ${u}`}},"$J8Wu7smPxV");if(!n.value)return o;throw n.value.statusCode===401?(q(),Error("登录过期，请重新登录")):n.value.statusCode===500?Error("服务端错误，请联系网站管理员"):Error(((t=n.value.data)==null?void 0:t.message)??"未知错误，请联系网站管理员")},po={key:2,flex:"","flex-col":"","gap-4":""},ho=V({__name:"guess",setup(u){const o=E(!0),n=U([]),t=X();return D(async()=>{try{const r=await fo();n.push(...r.value.map(d=>({id:d.id,isWinner:d.win,teamName:d.chickteam})))}catch(r){r instanceof Error&&t.error(r.message)}o.value=!1}),(r,d)=>{const m=te,h=Ze,s=ce,v=le,C=ne,w=Y;return f(),g(w,{title:"我的竞猜",style:{width:"calc(100vw - 2rem)"},"max-w-768px":""},{default:i(()=>[a(o)?(f(),g(h,{key:0},{header:i(()=>[_(m,{text:"","h-19px":"","w-20":""})]),default:i(()=>[_(m,{text:"","h-22px":"","w-40":""})]),_:1})):a(n).length===0?(f(),g(C,{key:1,description:"你没有参与过竞猜"},{extra:i(()=>[_(v,{to:"/schedule"},{default:i(()=>[_(s,{size:"small",type:"primary"},{default:i(()=>[k(" 前往竞猜 ")]),_:1})]),_:1})]),_:1})):(f(),H("div",po,[(f(!0),H(Ce,null,xe(a(n),b=>(f(),g(h,{key:b.id,title:b.isWinner?"预测正确":"预测错误",type:b.isWinner?"success":"error"},{default:i(()=>[k(M(b.teamName+(b.isWinner?"获胜":"战败")),1)]),_:2},1032,["title","type"]))),128))]))]),_:1})}}}),go={key:1,"my-4":"",flex:"","flex-col":"","gap-4":""},Fo=V({__name:"me",setup(u){ye({title:"个人中心 丨 ASG 第五人格赛事"});const o=E(!0),{me:n}=ee();return D(()=>{oe(n,()=>{typeof n.value>"u"||(o.value=!1)},{immediate:!0})}),(t,r)=>{const d=De,m=co,h=_o,s=ho;return!a(n)&&!a(o)?(f(),g(d,{key:0,status:"warning",title:"未登录",description:"在查看个人信息前请先登录",style:{"min-height":"calc(100vh - 50px - 60px)"},flex:"","flex-col":"","justify-center":"",size:"huge"})):(f(),H("div",go,[_(m),_(h),_(s)]))}}});export{Fo as default};
