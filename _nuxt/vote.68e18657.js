import{_ as z}from"./season.vue.04a1cbe3.js";import{_ as I}from"./team.vue.82944585.js";import{_ as P}from"./recaptcha.vue.7d7455bf.js";import{f as H,u as X,j as Z,r,i as e,g as f,c as k,a as E,b as p,w as d,F as q,k as J,G as K,D as O,o as c,t as Q,d as W,H as Y,v as ee}from"./entry.6528f58e.js";import{u as te,a as ae}from"./useLogout.8d99b21e.js";import{u as N,a as oe,_ as se}from"./use-message.66bdeb61.js";import{a as ne,u as re}from"./index.51fa0266.js";import{_ as le}from"./Button.b8ae23dc.js";import{_ as ie}from"./Modal.948a7be0.js";import{_ as ce}from"./Result.3ad77dfb.js";import{a as ue}from"./text.bd3463fb.js";import"./ready.3c027d06.js";import"./Tag.82b04240.js";import"./light.bfa30530.js";import"./Avatar.e5832989.js";import"./light.01ebe78d.js";const me=async(v,o,l,s)=>{var h;const n=ne("token",null).value;if(!n)throw Error("未登录");const{data:i,error:_}=await N("/form/all",{baseURL:"https://124.223.35.239/api/v1",headers:{authorization:`Bearer ${n}`},params:{eventsname:l,page:v,page_long:o,sort:s}},"$3FbuzmXuuA");if(!_.value)return i;throw _.value.statusCode===401?(te(),Error("登录过期，请重新登录")):_.value.statusCode===500?Error("服务端错误，请联系网站管理员"):Error(((h=_.value.data)==null?void 0:h.message)??"未知错误，请联系网站管理员")},_e=async(v,o)=>{var n;const{data:l,error:s}=await N("/form/like",{baseURL:"https://124.223.35.239/api/v1",method:"post",params:{captoken:o,name:v}},"$Dalx9gXCTf");if(!s.value)return l;throw s.value.statusCode===500?Error("服务端错误，请联系网站管理员"):Error(((n=s.value.data)==null?void 0:n.message)??"未知错误，请联系网站管理员")},pe={key:1,style:{width:"calc(100vw - 1rem)"},"my-2":"","max-w-1080px":"",flex:"","flex-col":"","items-center":"","gap-2":""},fe={style:{width:"calc(100% - 1rem)"},flex:"","justify-between":""},de=E("div",{"i-material-symbols-sort":"","text-xl":""},null,-1),ve={key:2,flex:"","flex-wrap":"","justify-center":"","gap-2":""},C=1,T=6,Le=H({__name:"vote",setup(v){X({title:"战队投票 丨 ASG 第五人格赛事"});const o=Z([]),l=r(!0),s=r(C),n=oe(),i=r(!1),_=r(null),{me:h}=ae(),u=r(!0),b=r(null),R=re(),g=r("vote"),w=r(null),x=async()=>{try{const t=await me(s.value,T,w.value??"all",g.value);return o.push(...t.value.map(a=>({logo:a.logo_uri,members:a.rolename.map(m=>({camp:m.lin==="求生者",name:m.name})),name:a.name,time:new Date(a.timer).toLocaleString(),vote:a.piaoshu}))),l.value=!1,t}catch(t){t instanceof Error&&n.error(t.message)}return l.value=!1,r([])},B=async()=>{l.value=!0,s.value++,(await x()).value.length===0&&n.info("没有更多数据了")},L=t=>{b.value=t,i.value=!0},U=async t=>{const a=b.value;if(a){try{a.vote=(await _e(a.name,t)).value.number,n.success("投票成功")}catch(m){m instanceof Error&&n.error(m.message)}i.value=!1}},M=async()=>{g.value=g.value==="time"?"vote":"time",u.value=!0,s.value=C,o.splice(0),await x(),u.value=!1},j=async t=>{w.value=t,u.value=!0,s.value=C,o.splice(0),await x(),u.value=!1};return(t,a)=>{const m=ce,A=z,V=le,$=I,S=se,D=ue,F=P,G=ie;return!e(h)&&!e(u)?(c(),f(m,{key:0,status:"warning",title:"未登录",description:"在查看战队投票信息前请先登录",style:{"min-height":"calc(100vh - 50px - 60px)"},flex:"","flex-col":"","justify-center":"",size:"huge"})):(c(),k("div",pe,[E("div",fe,[p(A,{name:e(w),"onUpdate:name":j},null,8,["name"]),p(V,{text:"",onClick:M},{default:d(()=>[E("div",null,Q(e(g)==="time"?"时间":"赞数")+"排序",1),de]),_:1})]),e(u)?(c(),f(S,{key:0,"max-w-350px":""},{default:d(()=>[p($)]),_:1})):e(o).length===0?(c(),f(D,{key:1,description:"暂时没有队伍报名"})):(c(),k("div",ve,[(c(!0),k(q,null,J(e(o),y=>(c(),f(S,{key:y.name,"max-w-350px":""},{default:d(()=>[p($,{team:y,"is-vote-visible":!0,onVote:L},null,8,["team"])]),_:2},1024))),128))])),!e(u)&&e(o).length%T===0&&e(o).length!==0?(c(),f(V,{key:3,tertiary:"",loading:e(l),type:"primary",onClick:B},{default:d(()=>[W(" 查看更多 ")]),_:1},8,["loading"])):K("",!0),p(G,{show:e(i),"onUpdate:show":a[0]||(a[0]=y=>O(i)?i.value=y:null),"mask-closable":!1,"max-w-350px":"",preset:"card"},{default:d(()=>[Y(p(F,{ref_key:"reCaptchaRef",ref:_,theme:e(R)?"dark":"light",onVerify:U},null,8,["theme"]),[[ee,e(i)]])]),_:1},8,["show"])]))}}});export{Le as default};
