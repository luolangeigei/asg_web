import{_ as j}from"./season.vue.ee49543d.js";import{_ as I}from"./team.vue.500f483e.js";import{_ as P}from"./recaptcha.vue.4bf308e1.js";import{f as X,u as H,z as Z,r,A as e,g as f,c as k,a as E,b as p,w as d,F as q,D as J,E as K,B as O,o as i,t as Q,d as W,G as Y,v as ee}from"./entry.422dfa9b.js";import{u as te,a as ae}from"./useLogout.be74a023.js";import{r as oe,u as B,c as se,d as ne,e as re}from"./index.14c17353.js";import{_ as le}from"./Button.a963cff1.js";import{_ as ce}from"./Modal.fdd41334.js";import{_ as ie}from"./Result.35dbd22d.js";import{b as ue}from"./text.3b86590f.js";import"./ready.3ab48dfc.js";import"./light.d75a070a.js";import"./light.13e31931.js";const me=async(v,o,l,s)=>{var h;const n=oe("token",null).value;if(!n)throw Error("未登录");const{data:c,error:_}=await B("/form/all",{baseURL:"https://124.223.35.239/api/v1",headers:{authorization:`Bearer ${n}`},params:{eventsname:l,page:v,page_long:o,sort:s}},"$3FbuzmXuuA");if(!_.value)return c;throw _.value.statusCode===401?(te(),Error("登录过期，请重新登录")):_.value.statusCode===500?Error("服务端错误，请联系网站管理员"):Error(((h=_.value.data)==null?void 0:h.message)??"未知错误，请联系网站管理员")},_e=async(v,o)=>{var n;const{data:l,error:s}=await B("/form/like",{baseURL:"https://124.223.35.239/api/v1",method:"post",params:{captoken:o,name:v}},"$Dalx9gXCTf");if(!s.value)return l;throw s.value.statusCode===500?Error("服务端错误，请联系网站管理员"):Error(((n=s.value.data)==null?void 0:n.message)??"未知错误，请联系网站管理员")},pe={key:1,style:{width:"calc(100vw - 1rem)"},"my-2":"","max-w-1080px":"",flex:"","flex-col":"","items-center":"","gap-2":""},fe={style:{width:"calc(100% - 1rem)"},flex:"","justify-between":""},de=E("div",{"i-material-symbols-sort":"","text-xl":""},null,-1),ve={key:2,flex:"","flex-wrap":"","justify-center":"","gap-2":""},C=1,T=6,Be=X({__name:"vote",setup(v){H({title:"战队投票 丨 ASG 第五人格赛事"});const o=Z([]),l=r(!0),s=r(C),n=se(),c=r(!1),_=r(null),{me:h}=ae(),u=r(!0),b=r(null),N=ne(),g=r("vote"),w=r(null),x=async()=>{try{const t=await me(s.value,T,w.value??"all",g.value);return o.push(...t.value.map(a=>({logo:a.logo_uri,members:a.rolename.map(m=>({camp:m.lin==="求生者",name:m.name})),name:a.name,time:new Date(a.timer).toLocaleString(),vote:a.piaoshu}))),l.value=!1,t}catch(t){t instanceof Error&&n.error(t.message)}return l.value=!1,r([])},R=async()=>{l.value=!0,s.value++,(await x()).value.length===0&&n.info("没有更多数据了")},L=t=>{b.value=t,c.value=!0},U=async t=>{const a=b.value;if(a){try{a.vote=(await _e(a.name,t)).value.number,n.success("投票成功")}catch(m){m instanceof Error&&n.error(m.message)}c.value=!1}},A=async()=>{g.value=g.value==="time"?"vote":"time",u.value=!0,s.value=C,o.splice(0),await x(),u.value=!1},M=async t=>{w.value=t,u.value=!0,s.value=C,o.splice(0),await x(),u.value=!1};return(t,a)=>{const m=ie,z=j,V=le,$=I,S=re,D=ue,F=P,G=ce;return!e(h)&&!e(u)?(i(),f(m,{key:0,status:"warning",title:"未登录",description:"在查看战队投票信息前请先登录",style:{"min-height":"calc(100vh - 50px - 60px)"},flex:"","flex-col":"","justify-center":"",size:"huge"})):(i(),k("div",pe,[E("div",fe,[p(z,{name:e(w),"onUpdate:name":M},null,8,["name"]),p(V,{text:"",onClick:A},{default:d(()=>[E("div",null,Q(e(g)==="time"?"时间":"赞数")+"排序",1),de]),_:1})]),e(u)?(i(),f(S,{key:0,"max-w-350px":""},{default:d(()=>[p($)]),_:1})):e(o).length===0?(i(),f(D,{key:1,description:"暂时没有队伍报名"})):(i(),k("div",ve,[(i(!0),k(q,null,J(e(o),y=>(i(),f(S,{key:y.name,"max-w-350px":""},{default:d(()=>[p($,{team:y,"is-vote-visible":!0,onVote:L},null,8,["team"])]),_:2},1024))),128))])),!e(u)&&e(o).length%T===0&&e(o).length!==0?(i(),f(V,{key:3,tertiary:"",loading:e(l),type:"primary",onClick:R},{default:d(()=>[W(" 查看更多 ")]),_:1},8,["loading"])):K("",!0),p(G,{show:e(c),"onUpdate:show":a[0]||(a[0]=y=>O(c)?c.value=y:null),"mask-closable":!1,"max-w-350px":"",preset:"card"},{default:d(()=>[Y(p(F,{ref_key:"reCaptchaRef",ref:_,theme:e(N)?"dark":"light",onVerify:U},null,8,["theme"]),[[ee,e(c)]])]),_:1},8,["show"])]))}}});export{Be as default};
