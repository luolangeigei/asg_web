import{_ as le}from"./recaptcha.vue.4f080bd0.js";import{f as te,r as m,k as Z,h as V,y as oe,m as ie,B as ce,i as de,j as I,u as ue,E as fe,G as _,c as H,g as T,J as W,b as h,a as f,w as g,F as D,L as K,I as me,o as b,t as $,d as B,z as ve,v as _e}from"./entry.f4d2fbff.js";import{u as pe,a as he}from"./useMe.8baa62df.js";import{V as ge,e as be,b as re,c as ye,d as xe,_ as we}from"./index.0deabf0b.js";import{i as X,o as ke,u as ze}from"./useUnknownError.9d277d68.js";import{a as Ee,_ as Re}from"./Modal.7b375a8a.js";import{t as Ce,_ as Le}from"./Tag.473bad75.js";import{c as je,g as q,G as Se,f as J,H as Fe,p as Q,u as Te,b as ne,m as $e,j as Be,I as Oe,n as Pe,D as Ve}from"./browser.2fb44edf.js";import{_ as Ie}from"./Button.f20048d6.js";import{_ as He,a as Me}from"./Skeleton.d0577500.js";import{_ as Ne}from"./text.1d9ff8f8.js";import{_ as Ge}from"./Empty.764c105d.js";import{_ as Ae}from"./Result.085ed373.js";import"./ready.43fbcabd.js";import"./light.623c9fb3.js";import"./light.e69c1392.js";import"./fade-in-scale-up.cssr.5e33b59d.js";import"./light.c9b8e1ea.js";const Ue=je("n-avatar-group"),We=q("avatar",`
 width: var(--n-merged-size);
 height: var(--n-merged-size);
 color: #FFF;
 font-size: var(--n-font-size);
 display: inline-flex;
 position: relative;
 overflow: hidden;
 text-align: center;
 border: var(--n-border);
 border-radius: var(--n-border-radius);
 --n-merged-color: var(--n-color);
 background-color: var(--n-merged-color);
 transition:
 border-color .3s var(--n-bezier),
 background-color .3s var(--n-bezier),
 color .3s var(--n-bezier);
`,[Se(J("&","--n-merged-color: var(--n-color-modal);")),Fe(J("&","--n-merged-color: var(--n-color-popover);")),J("img",`
 width: 100%;
 height: 100%;
 `),Q("text",`
 white-space: nowrap;
 display: inline-block;
 position: absolute;
 left: 50%;
 top: 50%;
 `),q("icon",`
 vertical-align: bottom;
 font-size: calc(var(--n-merged-size) - 6px);
 `),Q("text","line-height: 1.25")]),De=Object.assign(Object.assign({},ne.props),{size:[String,Number],src:String,circle:{type:Boolean,default:void 0},objectFit:String,round:{type:Boolean,default:void 0},bordered:{type:Boolean,default:void 0},onError:Function,fallbackSrc:String,intersectionObserverOptions:Object,lazy:Boolean,onLoad:Function,renderPlaceholder:Function,renderFallback:Function,imgProps:Object,color:String}),Ke=te({name:"Avatar",props:De,setup(n){const{mergedClsPrefixRef:i,inlineThemeDisabled:d}=Te(n),a=m(!1);let l=null;const s=m(null),c=m(null),y=()=>{const{value:t}=s;if(t&&(l===null||l!==t.innerHTML)){l=t.innerHTML;const{value:e}=c;if(e){const{offsetWidth:r,offsetHeight:o}=e,{offsetWidth:u,offsetHeight:L}=t,S=.9,F=Math.min(r/u*S,o/L*S,1);t.style.transform=`translateX(-50%) translateY(-50%) scale(${F})`}}},v=Z(Ue,null),z=V(()=>{const{size:t}=n;if(t)return t;const{size:e}=v||{};return e||"medium"}),j=ne("Avatar","-avatar",We,Ee,n,i),p=Z(Ce,null),x=V(()=>{if(v)return!0;const{round:t,circle:e}=n;return t!==void 0||e!==void 0?t||e:p?p.roundRef.value:!1}),C=V(()=>v?!0:n.bordered||!1),E=t=>{var e;if(!O.value)return;a.value=!0;const{onError:r,imgProps:o}=n;(e=o==null?void 0:o.onError)===null||e===void 0||e.call(o,t),r&&r(t)};oe(()=>n.src,()=>a.value=!1);const M=V(()=>{const t=z.value,e=x.value,r=C.value,{color:o}=n,{self:{borderRadius:u,fontSize:L,color:S,border:F,colorModal:G,colorPopover:A},common:{cubicBezierEaseInOut:U}}=j.value;let P;return typeof t=="number"?P=`${t}px`:P=j.value.self[$e("height",t)],{"--n-font-size":L,"--n-border":r?F:"none","--n-border-radius":e?"50%":u,"--n-color":o||S,"--n-color-modal":o||G,"--n-color-popover":o||A,"--n-bezier":U,"--n-merged-size":`var(--n-avatar-size-override, ${P})`}}),R=d?Be("avatar",V(()=>{const t=z.value,e=x.value,r=C.value,{color:o}=n;let u="";return t&&(typeof t=="number"?u+=`a${t}`:u+=t[0]),e&&(u+="b"),r&&(u+="c"),o&&(u+=Oe(o)),u}),M,n):void 0,O=m(!n.lazy);ie(()=>{if(X)return;let t;const e=ce(()=>{t==null||t(),t=void 0,n.lazy&&(t=ke(c.value,n.intersectionObserverOptions,O))});de(()=>{e(),t==null||t()})});const N=m(!n.lazy);return{textRef:s,selfRef:c,mergedRoundRef:x,mergedClsPrefix:i,fitTextTransform:y,cssVars:d?void 0:M,themeClass:R==null?void 0:R.themeClass,onRender:R==null?void 0:R.onRender,hasLoadError:a,handleError:E,shouldStartLoading:O,loaded:N,mergedOnLoad:t=>{var e;const{onLoad:r,imgProps:o}=n;r==null||r(t),(e=o==null?void 0:o.onLoad)===null||e===void 0||e.call(o,t),N.value=!0}}},render(){var n,i;const{$slots:d,src:a,mergedClsPrefix:l,lazy:s,onRender:c,mergedOnLoad:y,shouldStartLoading:v,loaded:z,hasLoadError:j}=this;c==null||c();let p;const x=!z&&!j&&(this.renderPlaceholder?this.renderPlaceholder():(i=(n=this.$slots).placeholder)===null||i===void 0?void 0:i.call(n));return this.hasLoadError?p=this.renderFallback?this.renderFallback():Pe(d.fallback,()=>[I("img",{src:this.fallbackSrc,style:{objectFit:this.objectFit}})]):p=Ve(d.default,C=>{if(C)return I(ge,{onResize:this.fitTextTransform},{default:()=>I("span",{ref:"textRef",class:`${l}-avatar__text`},C)});if(a){const{imgProps:E}=this;return I("img",Object.assign(Object.assign({},E),{loading:X&&!this.intersectionObserverOptions&&s?"lazy":"eager",src:X||v||z?a:void 0,onLoad:y,"data-image-src":a,onError:this.handleError,style:[E==null?void 0:E.style,{objectFit:this.objectFit},x?{height:"0",width:"0",visibility:"hidden",position:"absolute"}:""]}))}}),I("span",{ref:"selfRef",class:[`${l}-avatar`,this.themeClass],style:this.cssVars},p,s&&x)}}),Xe=async(n,i,d)=>{var c,y;const a=be("token",null).value;if(!a)throw Error("未登录");const{data:l,error:s}=await re("/form/all",{baseURL:"https://124.223.35.239/api/v1",headers:{authorization:`Bearer ${a}`},params:{page:n,page_long:i,sort:d}},"$3FbuzmXuuA");if(!s.value)return l;throw s.value.statusCode===401?(pe(),Error("登录过期，请重新登录")):s.value.statusCode===500?Error("服务端错误，请联系网站管理员"):Error(((c=s.value.data)==null?void 0:c.message)??s.value.message??((y=s.value.data)==null?void 0:y.code))},Je=async(n,i)=>{var l,s;const{data:d,error:a}=await re("/form/like",{baseURL:"https://124.223.35.239/api/v1",method:"post",params:{captoken:i,name:n}},"$Dalx9gXCTf");if(!a.value)return d;throw a.value.statusCode===500?Error("服务端错误，请联系网站管理员"):Error(((l=a.value.data)==null?void 0:l.message)??a.value.message??((s=a.value.data)==null?void 0:s.code))},Ye={key:0,"my-4":"","max-w-1080px":"","w-90vw":"",flex:"","flex-col":"","items-center":"","gap-2":""},Ze={key:1,"w-full":""},qe={"w-full":"","text-end":""},Qe=f("div",{"i-material-symbols-sort":"","text-xl":""},null,-1),et={flex:"","flex-wrap":"","justify-center":"","gap-2":""},tt={flex:"","flex-wrap":"","items-center":"","justify-center":"","gap-4":""},ot={flex:"","flex-col":""},rt={flex:"","flex-wrap":"","items-center":"","justify-between":""},nt={"text-xl":"","font-bold":""},at={flex:"","items-center":"","gap-1":""},st=f("div",{"i-material-symbols-thumb-up":""},null,-1),lt={"text-slate-500":""},it={flex:"","flex-wrap":"","gap-4":"","text-lg":""},ct={flex:"","flex-wrap":"","gap-4":"","text-lg":""},Y=1,ee=6,Lt=te({__name:"vote",setup(n){ue({title:"全部队伍 丨 ASG 第五人格赛事"});const i=fe([]),d=m(!0),a=m(Y),l=ye(),s=m(!1),c=m(null),{me:y}=he(),v=m(!0),z=m(null),j=xe(),p=m("vote"),x=async()=>{try{const e=await Xe(a.value,ee,p.value);return i.push(...e.value.map(r=>({logo:r.logo_uri,members:r.rolename.map(o=>({camp:o.lin==="求生者",name:o.name})),name:r.name,time:new Date(r.timer).toLocaleString(),vote:r.piaoshu}))),d.value=!1,e}catch(e){e instanceof Error&&l.error(e.message)}return m([])},C=async()=>{d.value=!0,a.value++,(await x()).value.length===0&&l.info("没有更多数据了")};oe(y,async()=>{a.value=Y,y.value&&(await x(),v.value=!1)},{immediate:!0});const E=e=>{z.value=e,s.value=!0},M=async e=>{const r=z.value;if(r){try{r.vote=(await Je(r.name,e)).value.number,l.success("投票成功")}catch(o){o instanceof Error&&l.error(o.message)}s.value=!1}},R=()=>{var e;(e=c.value)==null||e.reset()},O=()=>{var e;l.info("验证失败"),(e=c.value)==null||e.reset()},N=e=>{ze()},t=async()=>{p.value=p.value==="time"?"vote":"time",v.value=!0,a.value=Y,i.splice(0),await x(),v.value=!1};return(e,r)=>{const o=Ge,u=He,L=Ie,S=Ke,F=Le,G=Me,A=Ne,U=we,P=le,ae=Re,se=Ae;return _(y)?(b(),H("div",Ye,[_(i).length===0&&!_(v)?(b(),T(o,{key:0,description:"暂时没有队伍报名"})):W("",!0),_(v)?(b(),H("div",Ze,[h(u,{text:"",repeat:4}),h(u,{text:"",style:{width:"60%"}})])):W("",!0),f("div",qe,[h(L,{text:"",onClick:t},{default:g(()=>[f("div",null,$(_(p)==="time"?"时间":"赞数")+"排序",1),Qe]),_:1})]),f("div",et,[(b(!0),H(D,null,K(_(i),w=>(b(),T(U,{key:w.name,"max-w-350px":""},{default:g(()=>[f("div",tt,[h(S,{size:84,src:w.logo||"#","fallback-src":"~/assets/carousel-logo.webp","flex-none":"",color:"transparent","object-fit":"cover"},null,8,["src"]),f("div",ot,[f("div",rt,[f("div",nt,$(w.name),1),h(L,{size:"small",type:"primary",secondary:"",onClick:k=>E(w)},{default:g(()=>[f("div",at,[st,B(" "+$(w.vote),1)])]),_:2},1032,["onClick"])]),f("div",lt," 报名时间："+$(w.time),1)])]),h(G,null,{default:g(()=>[h(F,{type:"info",bordered:!1},{default:g(()=>[B(" 求生者 ")]),_:1})]),_:1}),f("div",it,[(b(!0),H(D,null,K(w.members.filter(k=>k.camp),k=>(b(),T(A,{key:k.name,type:"info"},{default:g(()=>[B($(k.name),1)]),_:2},1024))),128))]),h(G,null,{default:g(()=>[h(F,{type:"error",bordered:!1},{default:g(()=>[B(" 监管者 ")]),_:1})]),_:1}),f("div",ct,[(b(!0),H(D,null,K(w.members.filter(k=>!k.camp),k=>(b(),T(A,{key:k.name,type:"error"},{default:g(()=>[B($(k.name),1)]),_:2},1024))),128))])]),_:2},1024))),128))]),!_(v)&&_(i).length%ee===0?(b(),T(L,{key:2,tertiary:"",loading:_(d),type:"primary",onClick:C},{default:g(()=>[B(" 查看更多 ")]),_:1},8,["loading"])):W("",!0),h(ae,{show:_(s),"onUpdate:show":r[0]||(r[0]=w=>me(s)?s.value=w:null),"mask-closable":!1,"max-w-350px":"",preset:"card"},{default:g(()=>[ve(h(P,{ref_key:"reCaptchaRef",ref:c,theme:_(j)?"dark":"light",onVerify:M,onExpire:R,onFail:O,onError:N},null,8,["theme"]),[[_e,_(s)]])]),_:1},8,["show"])])):(b(),T(se,{key:1,status:"warning",title:"未登录",description:"在查看全部战队信息前请先登录",style:{"min-height":"calc(100vh - 50px - 60px)"},flex:"","flex-col":"","justify-center":"",size:"huge"}))}}});export{Lt as default};
